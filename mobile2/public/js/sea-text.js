function register(e){plugins[e.name]=e}function isPlugin(e){return e&&plugins.hasOwnProperty(e)}function getPluginName(e){for(var n in plugins)if(isPlugin(n)){var r=","+plugins[n].ext.join(",")+",";if(r.indexOf(","+e+",")>-1)return n}}function xhr(e,n){var r=global.XMLHttpRequest?new global.XMLHttpRequest:new global.ActiveXObject("Microsoft.XMLHTTP");return r.open("GET",e,!0),r.onreadystatechange=function(){if(4===r.readyState){if(r.status>399&&r.status<600)throw new Error("Could not load: "+e+", status = "+r.status);n(r.responseText)}},r.send(null)}function globalEval(e){e&&/\S/.test(e)&&(global.execScript||function(e){(global.eval||eval).call(global,e)})(e)}function jsEscape(e){return e.replace(/(["\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")}function pure(e){return e.replace(/\?.*$/,"")}var global=window,plugins={},uriCache={};register({name:"text",ext:[".tpl",".html"],exec:function(e,n){globalEval('define("'+e+'#", [], "'+jsEscape(n)+'")')}}),register({name:"json",ext:[".json"],exec:function(e,n){globalEval('define("'+e+'#", [], '+n+")")}}),register({name:"handlebars",ext:[".handlebars"],exec:function(e,n){var r=['define("'+e+'#", ["handlebars"], function(require, exports, module) {','  var source = "'+jsEscape(n)+'"','  var Handlebars = require("handlebars")["default"]',"  module.exports = function(data, options) {","    options || (options = {})","    options.helpers || (options.helpers = {})","    for (var key in Handlebars.helpers) {","      options.helpers[key] = options.helpers[key] || Handlebars.helpers[key]","    }","    return Handlebars.compile(source)(data, options)","  }","})"].join("\n");globalEval(r)}}),seajs.on("resolve",function(e){var n=e.id;if(!n)return"";var r,a;(a=n.match(/^(\w+)!(.+)$/))&&isPlugin(a[1])?(r=a[1],n=a[2]):(a=n.match(/[^?]+(\.\w+)(?:\?|#|$)/))&&(r=getPluginName(a[1])),r&&-1===n.indexOf("#")&&(n+="#");var t=seajs.resolve(n,e.refUri);r&&(uriCache[t]=r),e.uri=t}),seajs.on("request",function(e){var n=uriCache[e.uri];n&&(xhr(e.requestUri,function(r){plugins[n].exec(e.uri,r),e.onRequest()}),e.requested=!0)});